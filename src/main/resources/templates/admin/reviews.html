<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/header :: head}">
    <title>Отзывы - РУТ Навигатор</title>
</head>
<body>
    <header th:replace="~{fragments/header :: header}"></header>

    <main class="main-content">
        <div class="admin-container">
            <!-- Admin Sidebar -->
            <aside class="admin-sidebar">
                <nav class="admin-nav">
                    <a th:href="@{/admin}" class="admin-nav-link">Панель управления</a>
                    <a th:href="@{/admin/bookings}" class="admin-nav-link">Все бронирования</a>
                    <a th:href="@{/admin/calendar}" class="admin-nav-link">Календарь</a>
                    <a th:href="@{/admin/reviews}" class="admin-nav-link active">Отзывы</a>
                    <a th:href="@{/admin/dispatcher-issues}" class="admin-nav-link">Сообщенные проблемы</a>
                    <a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/rooms}" class="admin-nav-link">Управление аудиториями</a>
                </nav>
            </aside>

            <!-- Admin Content -->
            <div class="admin-content">
                <div class="page-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h1>Все отзывы</h1>
                    <a th:href="@{/admin/deleted-reviews}" class="btn btn-outline">Просмотр удаленных отзывов</a>
                </div>

                <div th:if="${success}" class="alert alert-success">
                    <span th:text="${success}">Успешно</span>
                </div>

                <div th:if="${error}" class="alert alert-error">
                    <span th:text="${error}">Ошибка</span>
                </div>

                <!-- Filters -->
                <form th:action="@{/admin/reviews}" method="get" class="filter-form admin-filters">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="roomId">Аудитория</label>
                            <select name="roomId" id="roomId" class="filter-select">
                                <option value="">Все аудитории</option>
                                <option th:each="r : ${rooms}" th:value="${r.id}"
                                        th:text="'Аудитория ' + ${r.number}" th:selected="${selectedRoomId == r.id}">Аудитория</option>
                            </select>
                        </div>

                        <div class="filter-actions">
                            <button type="submit" class="btn btn-primary">Применить</button>
                            <a th:href="@{/admin/reviews}" class="btn btn-outline">Очистить</a>
                        </div>
                    </div>
                </form>

                <!-- Reviews Table -->
                <div class="bookings-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Пользователь</th>
                                <th>Аудитория</th>
                                <th>Рейтинг</th>
                                <th>Комментарий</th>
                                <th>Дата</th>
                                <th>Изображение</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(reviews)}">
                                <td colspan="8" class="no-data">Отзывы не найдены</td>
                            </tr>
                            <tr th:each="review : ${reviews}">
                                <td th:text="${review.id}">#123</td>
                                <td th:text="${review.userName}">Имя пользователя</td>
                                <td th:text="'Ауд. ' + ${review.roomNumber}">Ауд. 1234</td>
                                <td>
                                    <span class="rating-stars">
                                        <span th:each="i : ${#numbers.sequence(1, review.rating)}">⭐</span>
                                    </span>
                                    <span th:text="${review.rating}">(5)</span>
                                </td>
                                <td class="purpose-cell" th:text="${review.comment}">Отличная аудитория!</td>
                                <td th:text="${#temporals.format(review.createdAt, 'dd.MM.yyyy HH:mm')}">01.01.2025 10:00</td>
                                <td>
                                    <a th:if="${review.imagePath}" th:href="${review.imagePath}" target="_blank" class="btn btn-outline btn-sm">Просмотр</a>
                                    <span th:unless="${review.imagePath}">-</span>
                                </td>
                                <td class="actions-cell">
                                    <a th:href="@{/rooms/{id}(id=${review.roomId})}" class="btn btn-outline btn-sm">Просмотр аудитории</a>
                                    <form th:if="${user.admin}" th:action="@{/reviews/delete/{id}(id=${review.id}, redirectUrl='/admin/reviews')}" method="post"
                                          style="display: inline-block; margin-left: 8px;"
                                          onsubmit="return confirm('Вы уверены, что хотите удалить этот отзыв?')">
                                        <button type="submit" class="btn btn-outline btn-sm btn-danger">Удалить</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="~{fragments/footer :: footer}"></footer>

    <script th:src="@{/js/main.js}"></script>
</body>
</html>
