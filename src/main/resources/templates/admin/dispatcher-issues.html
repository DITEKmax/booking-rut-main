<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/header :: head}">
    <title>–°–æ–æ–±—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã - –†–£–¢ –ù–∞–≤–∏–≥–∞—Ç–æ—Ä</title>
</head>
<body>
    <header th:replace="~{fragments/header :: header}"></header>

    <main class="main-content">
        <div class="admin-container">
            <!-- Admin Sidebar -->
            <aside class="admin-sidebar">
                <nav class="admin-nav">
                    <a th:href="@{/admin}" class="admin-nav-link">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                    <a th:href="@{/admin/bookings}" class="admin-nav-link">–í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a>
                    <a th:href="@{/admin/calendar}" class="admin-nav-link">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
                    <a th:href="@{/admin/reviews}" class="admin-nav-link">–û—Ç–∑—ã–≤—ã</a>
                    <a th:href="@{/admin/dispatcher-issues}" class="admin-nav-link active">–°–æ–æ–±—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã</a>
                </nav>
            </aside>

            <!-- Admin Content -->
            <div class="admin-content">
                <h1>–°–æ–æ–±—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –æ—Ç–∑—ã–≤–æ–≤</h1>

                <div th:if="${success}" class="alert alert-success">
                    <span th:text="${success}">–£—Å–ø–µ—à–Ω–æ</span>
                </div>

                <div th:if="${error}" class="alert alert-error">
                    <span th:text="${error}">–û—à–∏–±–∫–∞</span>
                </div>

                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    –ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –æ—Ç–∑—ã–≤—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–æ–±—â–∏–ª–∏ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∞—É–¥–∏—Ç–æ—Ä–∏—è–º–∏.
                    –ü—Ä–æ–±–ª–µ–º—ã –≤–∫–ª—é—á–∞—é—Ç: —Å–ª–æ–º–∞–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤, –ø—Ä–æ–±–ª–µ–º—ã —Å —á–∏—Å—Ç–æ—Ç–æ–π –∏ —Ç.–¥.
                </p>

                <!-- Issues Table -->
                <div class="bookings-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ê—É–¥–∏—Ç–æ—Ä–∏—è</th>
                                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                <th>–†–µ–π—Ç–∏–Ω–≥</th>
                                <th>–°–æ–æ–±—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã</th>
                                <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                                <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(reviews)}">
                                <td colspan="9" class="no-data">–ü—Ä–æ–±–ª–µ–º—ã –Ω–µ —Å–æ–æ–±—â–µ–Ω—ã</td>
                            </tr>
                            <tr th:each="review : ${reviews}">
                                <td th:text="${review.id}">#123</td>
                                <td th:text="${#temporals.format(review.createdAt, 'dd.MM.yyyy HH:mm')}">01.01.2025 10:00</td>
                                <td th:text="'–ê—É–¥. ' + ${review.roomNumber}">–ê—É–¥. 1234</td>
                                <td th:text="${review.userName}">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</td>
                                <td>
                                    <span class="rating-stars">
                                        <span th:each="i : ${#numbers.sequence(1, review.rating)}">‚≠ê</span>
                                    </span>
                                    <span th:text="${review.rating}">(5)</span>
                                </td>
                                <td>
                                    <div class="issues-list">
                                        <span th:each="issue, iterStat : ${#strings.arraySplit(review.issues, ',')}"
                                              class="issue-badge"
                                              th:text="${issue}">–ü—Ä–æ–±–ª–µ–º–∞</span>
                                    </div>
                                </td>
                                <td class="purpose-cell" th:text="${review.comment}">–û—Ç–ª–∏—á–Ω–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è!</td>
                                <td>
                                    <a th:if="${review.imagePath}" th:href="${review.imagePath}" target="_blank" class="btn btn-outline btn-sm">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                                    <span th:unless="${review.imagePath}">-</span>
                                </td>
                                <td class="actions-cell">
                                    <a th:href="@{/rooms/{id}(id=${review.roomId})}" class="btn btn-outline btn-sm">–ü—Ä–æ—Å–º–æ—Ç—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏</a>
                                    <form th:if="${!review.issuesMarkedRelevant}" th:action="@{/admin/dispatcher-issues/{id}/mark-relevant(id=${review.id})}" method="post" style="display: inline; margin-left: 8px;">
                                        <button type="submit" class="btn btn-primary btn-sm">–ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞</button>
                                    </form>
                                    <span th:if="${review.issuesMarkedRelevant}" class="badge" style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-left: 8px;">
                                        ‚úì –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div th:if="${!#lists.isEmpty(reviews)}" style="margin-top: 20px; padding: 15px; background: var(--light-bg); border-radius: var(--radius-md);">
                    <h3 style="margin-bottom: 10px;">–¢–∏–ø—ã –ø—Ä–æ–±–ª–µ–º:</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li>üîß <strong>–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ—Ä</strong></li>
                        <li>‚úèÔ∏è <strong>–ù–µ—Ç –º–∞—Ä–∫–µ—Ä–æ–≤</strong></li>
                        <li>ü™ë <strong>–°–ª–æ–º–∞–Ω–∞ –ø–∞—Ä—Ç–∞/—Å—Ç—É–ª</strong></li>
                        <li>üíª <strong>–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–ø—å—é—Ç–µ—Ä</strong></li>
                        <li>ü™ü <strong>–°–ª–æ–º–∞–Ω–æ –æ–∫–Ω–æ</strong></li>
                        <li>üßπ <strong>–ì—Ä—è–∑–Ω–æ</strong></li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="~{fragments/footer :: footer}"></footer>

    <script th:src="@{/js/main.js}"></script>

    <style>
        .issues-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            max-width: 200px;
        }

        .issue-badge {
            display: inline-block;
            padding: 4px 8px;
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 4px;
            font-size: 11px;
            color: #856404;
            white-space: nowrap;
        }

        .bookings-table-container {
            overflow-x: auto;
            width: 100%;
        }

        .admin-table {
            min-width: 1200px;
            table-layout: fixed;
        }

        .admin-table th:nth-child(1) { width: 50px; }   /* ID */
        .admin-table th:nth-child(2) { width: 120px; }  /* –î–∞—Ç–∞ */
        .admin-table th:nth-child(3) { width: 100px; }  /* –ê—É–¥–∏—Ç–æ—Ä–∏—è */
        .admin-table th:nth-child(4) { width: 150px; }  /* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å */
        .admin-table th:nth-child(5) { width: 80px; }   /* –†–µ–π—Ç–∏–Ω–≥ */
        .admin-table th:nth-child(6) { width: 200px; }  /* –°–æ–æ–±—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã */
        .admin-table th:nth-child(7) { width: 200px; }  /* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π */
        .admin-table th:nth-child(8) { width: 100px; }  /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        .admin-table th:nth-child(9) { width: 200px; }  /* –î–µ–π—Å—Ç–≤–∏—è */

        .admin-table td {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .actions-cell {
            white-space: nowrap;
        }

        .actions-cell .btn {
            display: inline-block;
            margin: 2px;
            font-size: 12px;
            padding: 6px 10px;
        }

        .actions-cell form {
            display: inline-block;
            margin: 2px;
        }

        .actions-cell .badge {
            display: inline-block;
            margin: 2px;
            font-size: 11px;
        }
    </style>
</body>
</html>
